{"ast":null,"code":"import _toConsumableArray from\"C:/Users/tuu18/Documents/csc309/team63/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _defineProperty from\"C:/Users/tuu18/Documents/csc309/team63/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"C:/Users/tuu18/Documents/csc309/team63/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"C:/Users/tuu18/Documents/csc309/team63/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState}from'react';import UploadCoverPhoto from'../UploadCoverPhoto';import\"./styles.css\";import FormRow from'../FormRow';import SelectCategories from'../SelectCategories';import SelectReference from'../SelectReference';import defaultCoverPhoto from'../../data/default_cover_photo.jpeg';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function UploadWorkDetails(props){var defaultFormInputs={title:\"\",references:[{workId:null,description:\"\"}],categories:[],hashtags:[],audio:\"\",description:\"\",coverImage:defaultCoverPhoto};var _useState=useState(defaultFormInputs),_useState2=_slicedToArray(_useState,2),uploadFormInputs=_useState2[0],setUploadFormInputs=_useState2[1];var _useState3=useState(\"Click this area to select a file\"),_useState4=_slicedToArray(_useState3,2),audioLabel=_useState4[0],setAudioLabel=_useState4[1];var _useState5=useState([[]]),_useState6=_slicedToArray(_useState5,2),selectedRefWork=_useState6[0],setSelectedRefWork=_useState6[1];var downloads=props.currentUser.downloadedWorks.map(function(work){return{name:work.title+\" - \"+work.artist,id:work.id};});var handleInputChange=function handleInputChange(event){var name=event.target.name;var value;if(name===\"hashtags\"){value=event.target.value.split(/[ #]+/);}else if(name===\"coverImage\"){var image=event.target.files[0];if(image){value=URL.createObjectURL(image);}else{return;}}else{value=event.target.value;}setUploadFormInputs(function(inputs){return _objectSpread(_objectSpread({},inputs),{},_defineProperty({},name,value));});};var handleCategoryChange=function handleCategoryChange(categoriesList){var name='categories';setUploadFormInputs(function(inputs){return _objectSpread(_objectSpread({},inputs),{},_defineProperty({},name,categoriesList));});};var handleRefAdd=function handleRefAdd(event){event.preventDefault();var references=[].concat(_toConsumableArray(uploadFormInputs.references),[{workId:null,description:\"\"}]);var name='references';setUploadFormInputs(function(inputs){return _objectSpread(_objectSpread({},inputs),{},_defineProperty({},name,references));});var works=[].concat(_toConsumableArray(selectedRefWork),[[]]);setSelectedRefWork(works);};var handleRefRemove=function handleRefRemove(idx,event){event.preventDefault();var name='references';var references=_toConsumableArray(uploadFormInputs.references);references.splice(idx,1);setUploadFormInputs(function(inputs){return _objectSpread(_objectSpread({},inputs),{},_defineProperty({},name,references));});var works=_toConsumableArray(selectedRefWork);works.splice(idx,1);setSelectedRefWork(works);};var handleAudioChange=function handleAudioChange(event){if(event.target.files.length){console.log(event.target.files);var name=\"audio\";var value=URL.createObjectURL(event.target.files[0]);setUploadFormInputs(function(inputs){return _objectSpread(_objectSpread({},inputs),{},_defineProperty({},name,value));});setAudioLabel(event.target.files[0].name);}};var handleRefSelect=function handleRefSelect(idx,workId,selectedWork){var references=_toConsumableArray(uploadFormInputs.references);references[idx].workId=workId;var name='references';setUploadFormInputs(function(inputs){return _objectSpread(_objectSpread({},inputs),{},_defineProperty({},name,references));});var works=_toConsumableArray(selectedRefWork);works[idx]=selectedWork;setSelectedRefWork(works);};var handleDescriptionChange=function handleDescriptionChange(idx,event){var references=_toConsumableArray(uploadFormInputs.references);references[idx].description=event.target.value;var name='references';setUploadFormInputs(function(inputs){return _objectSpread(_objectSpread({},inputs),{},_defineProperty({},name,references));});};var handleUpload=function handleUpload(event){//a post request will be made with the upload form data, including the cover image\nevent.preventDefault();setUploadFormInputs(defaultFormInputs);setSelectedRefWork([[]]);return alert(\"Your work was successfully uploaded\");};return/*#__PURE__*/_jsxs(\"div\",{id:\"upload-page\",children:[/*#__PURE__*/_jsxs(\"div\",{id:\"work-details\",children:[/*#__PURE__*/_jsx(\"div\",{id:\"header-container\",children:/*#__PURE__*/_jsx(\"h1\",{className:\"page-title\",children:\"Work Details\"})}),/*#__PURE__*/_jsx(\"div\",{id:\"details-container\",children:/*#__PURE__*/_jsxs(\"form\",{id:\"upload-form\",children:[/*#__PURE__*/_jsx(FormRow,{label:\"Title\",type:\"text\",className:\"input-box\",value:uploadFormInputs.title,handleChange:handleInputChange,name:\"title\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"input-label\",children:\"Categories\"}),/*#__PURE__*/_jsx(SelectCategories,{selectedValues:uploadFormInputs.categories,disabled:false,handleSelect:handleCategoryChange})]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(FormRow,{label:\"Hashtags\",type:\"text\",className:\"input-box\",value:uploadFormInputs.hashtags.join(\" #\"),handleChange:handleInputChange,name:\"hashtags\",placeholder:\"#hashtag1 #hashtag2\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"input-label\",children:\"Audio File\"}),/*#__PURE__*/_jsx(\"label\",{className:\"input-box\",id:\"audio-file-label\",htmlFor:\"audio-file\",children:audioLabel}),/*#__PURE__*/_jsx(\"input\",{id:\"audio-file\",type:\"file\",accept:\".mp3, .wav\",onChange:handleAudioChange})]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"input-label\",children:\"Description\"}),/*#__PURE__*/_jsx(\"textarea\",{className:\"description-text-box\",name:\"description\",value:uploadFormInputs.description,onChange:handleInputChange})]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"input-label\",children:\"Referenced Works\"}),uploadFormInputs.references.map(function(ref,idx){return/*#__PURE__*/_jsxs(\"div\",{className:\"add-ref-box\",children:[/*#__PURE__*/_jsx(SelectReference,{options:downloads,selectedOptions:selectedRefWork[idx],selectLimit:1,handleSelect:function handleSelect(selectedWork){return handleRefSelect(idx,selectedWork.length?selectedWork[0].id:\"\",selectedWork);}}),/*#__PURE__*/_jsx(\"textarea\",{className:\"description-text-box ref-description\",name:\"description\",value:uploadFormInputs.references[idx].description,onChange:function onChange(event){return handleDescriptionChange(idx,event);},placeholder:\"How did you use this work?\"}),uploadFormInputs.references.length>1&&/*#__PURE__*/_jsx(\"button\",{className:\"remove-ref-btn red-box-btn\",onClick:function onClick(event){return handleRefRemove(idx,event);},children:\"-\"}),/*#__PURE__*/_jsx(\"button\",{className:\"add-ref-btn\",onClick:handleRefAdd,children:\"+\"})]},idx);})]})]})})]}),/*#__PURE__*/_jsx(UploadCoverPhoto,{coverImageSrc:uploadFormInputs.coverImage,handleImgChange:handleInputChange,handleUpload:handleUpload})]});}export default UploadWorkDetails;","map":{"version":3,"sources":["C:/Users/tuu18/Documents/csc309/team63/client/src/components/UploadWorkDetails/index.js"],"names":["React","useState","UploadCoverPhoto","FormRow","SelectCategories","SelectReference","defaultCoverPhoto","UploadWorkDetails","props","defaultFormInputs","title","references","workId","description","categories","hashtags","audio","coverImage","uploadFormInputs","setUploadFormInputs","audioLabel","setAudioLabel","selectedRefWork","setSelectedRefWork","downloads","currentUser","downloadedWorks","map","work","name","artist","id","handleInputChange","event","target","value","split","image","files","URL","createObjectURL","inputs","handleCategoryChange","categoriesList","handleRefAdd","preventDefault","works","handleRefRemove","idx","splice","handleAudioChange","length","console","log","handleRefSelect","selectedWork","handleDescriptionChange","handleUpload","alert","join","ref"],"mappings":"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","sourcesContent":["import React, { useState } from 'react';\nimport UploadCoverPhoto from '../UploadCoverPhoto';\nimport \"./styles.css\";\nimport FormRow from '../FormRow';\nimport SelectCategories from '../SelectCategories';\nimport SelectReference from '../SelectReference';\nimport PropTypes from 'prop-types';\nimport defaultCoverPhoto from '../../data/default_cover_photo.jpeg';\n\nfunction UploadWorkDetails (props) {\n\n    const defaultFormInputs = {\n        title: \"\",\n        references: [{workId: null, description: \"\"}],\n        categories: [],\n        hashtags:[],\n        audio: \"\",\n        description: \"\",\n        coverImage: defaultCoverPhoto\n    };\n\n    const [uploadFormInputs, setUploadFormInputs] = useState(defaultFormInputs);\n    const [audioLabel, setAudioLabel] = useState(\"Click this area to select a file\");\n    const [selectedRefWork, setSelectedRefWork] = useState([[]]);\n\n    const downloads = props.currentUser.downloadedWorks.map(work => {\n        return {name: work.title + \" - \" + work.artist, id: work.id }});\n\n    const handleInputChange = (event) => {\n        const name = event.target.name;\n        let value;\n        if(name === \"hashtags\") {\n            value = event.target.value.split(/[ #]+/);\n        } else if(name === \"coverImage\") {\n            const image = event.target.files[0];\n            if(image) {\n                value = URL.createObjectURL(image);\n            } else {\n                return;\n            }\n        }\n        else {\n            value = event.target.value;\n        }\n\n        setUploadFormInputs(inputs => ({...inputs, [name]: value}));\n    };\n\n    const handleCategoryChange = (categoriesList) => {\n        const name = 'categories';\n        setUploadFormInputs(inputs => ({...inputs, [name]: categoriesList}));\n    };\n\n    const handleRefAdd = (event) => {\n        event.preventDefault();\n        const references = [...uploadFormInputs.references, {workId: null, description: \"\"}];\n        const name = 'references';\n        setUploadFormInputs(inputs => ({...inputs, [name]: references}));\n        const works = [...selectedRefWork, []];\n        setSelectedRefWork(works);\n    }\n\n    const handleRefRemove = (idx, event) => {\n        event.preventDefault();\n        const name = 'references';\n        let references = [...uploadFormInputs.references];\n        references.splice(idx,1);\n        setUploadFormInputs(inputs => ({...inputs, [name]: references}));\n        let works = [...selectedRefWork];\n        works.splice(idx,1);\n        setSelectedRefWork(works);\n      }\n\n    const handleAudioChange = (event) => {\n        if(event.target.files.length){\n            console.log(event.target.files);\n            const name = \"audio\";\n            const value = URL.createObjectURL(event.target.files[0]);\n            setUploadFormInputs(inputs => ({...inputs, [name]: value}));\n            setAudioLabel(event.target.files[0].name);\n        }\n    }\n\n    const handleRefSelect = (idx, workId, selectedWork) => {\n        let references = [...uploadFormInputs.references];\n        references[idx].workId = workId;\n        const name = 'references';\n        setUploadFormInputs(inputs => ({...inputs, [name]: references}));\n        let works = [...selectedRefWork];\n        works[idx] = selectedWork;\n        setSelectedRefWork(works);\n    }\n\n    const handleDescriptionChange = (idx, event) => {\n        let references = [...uploadFormInputs.references];\n        references[idx].description = event.target.value;\n        const name = 'references';\n        setUploadFormInputs(inputs => ({...inputs, [name]: references}));\n    }\n\n    const handleUpload = (event) => {\n        //a post request will be made with the upload form data, including the cover image\n        event.preventDefault();\n        setUploadFormInputs(defaultFormInputs);\n        setSelectedRefWork([[]]);\n        return alert(\"Your work was successfully uploaded\");\n    }\n\n\n    return(\n        <div id=\"upload-page\"> \n            <div id=\"work-details\">\n                <div id=\"header-container\">\n                    <h1 className=\"page-title\">Work Details</h1>\n                </div>\n\n                <div id=\"details-container\">\n                    <form id=\"upload-form\">\n                        <FormRow label={\"Title\"} type={\"text\"} className={\"input-box\"} value={uploadFormInputs.title} \n                            handleChange={handleInputChange} name={\"title\"}/>\n                        <br/>\n                        <div className=\"row\">\n                            <label className=\"input-label\">Categories</label>\n                            <SelectCategories selectedValues={uploadFormInputs.categories} disabled={false} handleSelect={handleCategoryChange}/>\n                        </div>\n                        <br/>\n                        <FormRow label={\"Hashtags\"} type={\"text\"} className={\"input-box\"} value={uploadFormInputs.hashtags.join(\" #\")} \n                            handleChange={handleInputChange} name={\"hashtags\"} placeholder={\"#hashtag1 #hashtag2\"}/>\n                        <br/>\n                        <div className=\"row\">\n                            <label className=\"input-label\">Audio File</label>\n                            <label className=\"input-box\" id=\"audio-file-label\" htmlFor=\"audio-file\">{audioLabel}</label>\n                            <input id=\"audio-file\" type=\"file\" accept=\".mp3, .wav\" onChange={handleAudioChange}/>\n                        </div>\n                        <br/>\n                        <div className=\"row\">\n                            <label className=\"input-label\">Description</label>\n                            <textarea className=\"description-text-box\" name=\"description\" value={uploadFormInputs.description} onChange={handleInputChange}/>\n                        </div>\n                        <br/>\n                        <div className=\"row\">\n                            <label className=\"input-label\">Referenced Works</label>\n                                {uploadFormInputs.references.map((ref, idx) => {\n                                    return (\n                                        <div className=\"add-ref-box\" key={idx}> \n                                            <SelectReference options={downloads} selectedOptions={selectedRefWork[idx]} selectLimit={1}\n                                                handleSelect={selectedWork => handleRefSelect(idx, selectedWork.length ? selectedWork[0].id : \"\", selectedWork)}/>\n                                            <textarea className=\"description-text-box ref-description\" name=\"description\" value={uploadFormInputs.references[idx].description}\n                                                onChange={event => handleDescriptionChange(idx, event)} placeholder={\"How did you use this work?\"}/>\n                                            {uploadFormInputs.references.length > 1 && <button className=\"remove-ref-btn red-box-btn\"\n                                                                                            onClick={event => handleRefRemove(idx, event)}>-</button>}\n                                            <button className=\"add-ref-btn\" onClick={handleRefAdd}>+</button>\n                                        </div>\n                                    );\n                                })}\n                        </div>\n                    </form>\n                </div>\n            </div>\n\n            <UploadCoverPhoto coverImageSrc={uploadFormInputs.coverImage} handleImgChange={handleInputChange} handleUpload={handleUpload}/>\n        </div>\n    );\n\n}\n\nUploadWorkDetails.propTypes = {\n    currentUser: PropTypes.object\n};\n\nexport default UploadWorkDetails;"]},"metadata":{},"sourceType":"module"}